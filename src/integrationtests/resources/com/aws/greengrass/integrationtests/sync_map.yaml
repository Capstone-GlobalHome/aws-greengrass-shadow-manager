---
services:
  aws.greengrass.Nucleus:
    configuration:
      runWithDefault:
        posixUser: nobody
  co.mgh.ShadowManager:
    configuration:
      synchronize:
        shadowDocumentsMap:
          Thing1:
            classic: true
          Thing2:
            namedShadows:
              - "foo"
              - "bar"

  main:
    dependencies:
      - DoAll
  DoAll:
    lifecycle:
      startup: echo "Running"
      shutdown: echo "Stopping"
    dependencies:
      - co.mgh.ShadowManager
    configuration:
      accessControl:
        co.mgh.ShadowManager:
          policyId1:
            policyDescription: access to CRUD shadow operations
            operations:
              - 'aws.greengrass#GetThingShadow'
              - 'aws.greengrass#UpdateThingShadow'
              - 'aws.greengrass#DeleteThingShadow'
            resources:
              - '*'
          policyId2:
            policyDescription: access to list named shadows
            operations:
              - 'aws.greengrass#ListNamedShadowsForThing'
            resources:
              - '*'
        aws.greengrass.ipc.pubsub:
          policyId3:
            policyDescription: access to pubsub topics
            operations:
              - 'aws.greengrass#SubscribeToTopic'
            resources:
              - '*'
